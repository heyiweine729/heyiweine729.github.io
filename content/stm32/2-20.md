
---
title: "STM32 学习笔记：Part 2 - GPIO 核心原理与输出控制"
date: 2026-02-21
tags: ["STM32", "Embedded", "Hardware", "GPIO"]
description: "STM32 GPIO 端口的底层逻辑、标准库函数调用以及八大工作模式深度解析。"
---

学习进度：进行中 
关键主题：GPIO, 寄存器操作, 输入输出模式, 标准库函数, 推挽与开漏

## 一、 GPIO 核心操作与概念

### 1. 基础读写函数概览
在使用标准库点灯或控制外设时，最常用的是以下四个修改引脚电平的函数：

| 函数名 | 操作对象 | 改变为什么状态？ |
| :--- | :--- | :--- |
| **`GPIO_SetBits`** | 指定的一个或多个引脚 | 强制高电平 (1) |
| **`GPIO_ResetBits`** | 指定的一个或多个引脚 | 强制低电平 (0) |
| **`GPIO_WriteBit`** | 指定的单个引脚 | 由第三个参数 (`Bit_RESET` / `Bit_SET`) 决定 |
| **`GPIO_Write`** | 整个端口 (16个引脚) | 由 16 位数值决定 |

### 2. “街道”与“门牌号”类比
STM32 芯片有很多引脚，工程师把它们按 16 个一组分成了不同的“街道”（端口）：

* **`GPIOA`（街道名）**：当你写下 `GPIOA` 时，你是在告诉芯片：“我要去 A 街办事”。
* **`GPIO_Pin_0`（门牌号）**：每一条街上有 16 个房子，当你写下 `GPIO_Pin_0`，代表精确指定“A 街上的 **0 号房**”。

---

## 二、 `GPIO_InitTypeDef` 结构体详解

这个结构体是配置引脚的“登记表”。在 F1 系列中，它包含三个核心成员：

### 3. F1 系列配置三要素
```c
typedef struct {
  uint16_t GPIO_Pin;             // 选择引脚编号 (Pin_0 ~ Pin_15)
  GPIOSpeed_TypeDef GPIO_Speed;  // 输出速度 (2MHz / 10MHz / 50MHz)
  GPIOMode_TypeDef GPIO_Mode;    // 工作模式 (输入/输出/复用/模拟)
} GPIO_InitTypeDef;

```

> **关键记忆**：先选**引脚**，再选**模式**，最后选**速度**，然后调用 `GPIO_Init()` 写入寄存器。

### 4. F4 系列进阶对比

F4 系列将配置拆分得更加专业，包含 5 个成员，实现了“模式”与“物理特性”的彻底解耦：

* `GPIO_Mode`：基本模式 (IN / OUT / AF / AN)
* `GPIO_OType`：输出类型 (推挽 / 开漏)
* `GPIO_PuPd`：上下拉配置 (无 / 上拉 / 下拉)

---

## 三、 八种工作模式深度解析

### 5. 四种输入模式

* **模拟输入 (`GPIO_Mode_AIN`)**：关闭数字输入功能，信号直接送入 ADC 模块。功耗最低。
* **浮空输入 (`GPIO_Mode_IN_FLOATING`)**：内部无上下拉电阻，电平完全由外部决定。悬空时电平随机跳变（常用于 USART_RX）。
* **下拉输入 (`GPIO_Mode_IPD`)**：内部接下拉电阻到 GND，默认低电平。用于检测外部高电平信号。
* **上拉输入 (`GPIO_Mode_IPU`)**：内部接上拉电阻到 VCC，默认高电平。用于检测外部低电平信号（最常见的按键接法）。

### 6. 四种输出模式（核心区别：推挽 vs 开漏）

| 模式分类 | 特点与工作原理 | 典型应用场景 |
| --- | --- | --- |
| **推挽输出 (`Out_PP`)** | **最常用**。内部有两个 MOS 管，能主动输出强高/低电平，驱动能力强。 | 点亮 LED、驱动蜂鸣器、继电器控制。 |
| **开漏输出 (`Out_OD`)** | 只能主动拉低，**不能主动输出高**。高电平需外接上拉电阻。 | 5V 电平转换、I2C 通信、多设备共用总线（线与）。 |
| **复用推挽 (`AF_PP`)** | 引脚控制权交给**片上外设**（而非 CPU）。具备推挽的强驱动力。 | SPI (SCK/MOSI)、USART_TX、TIM PWM 输出。 |
| **复用开漏 (`AF_OD`)** | 引脚控制权交给外设，且具备开漏特性。 | I2C 的 SCL / SDA 通信线。 |

### 7. 常用外设配置速查表

日常敲代码时，如果忘记外设对应什么模式，可以直接查这里：

```c
// 基础输出
LED              -> GPIO_Mode_Out_PP    (推挽输出)
// 基础输入
按键 (按下接地)  -> GPIO_Mode_IPU       (上拉输入)
ADC 采集电压     -> GPIO_Mode_AIN       (模拟输入)
// 串口通信
USART_TX (发送)  -> GPIO_Mode_AF_PP     (复用推挽)
USART_RX (接收)  -> GPIO_Mode_IN_FLOATING 或 IPU
// 其他总线
I2C_SCL/SDA      -> GPIO_Mode_AF_OD     (复用开漏)
PWM 波输出       -> GPIO_Mode_AF_PP     (复用推挽)

```
